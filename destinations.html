<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destinations</title>
      <!-- css stylesheet -->
    <link rel="stylesheet" href="./assets/css/style.css">
 
    <!-- Bootstrap link -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

     <!-- map script -->
     <script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJoOGB75_bpzjqUae_aj1kBl_JIZJdu4I&libraries=places&v=beta&loading=async"
  async
  defer>
</script>

<script>
let map;
let poiMarkers = [];
let activeCollapse = null;

// ---------- CARD CLICK ----------
function attachCardClickHandlers() {
  document.querySelectorAll(".place-card").forEach(card => {
    card.addEventListener("click", () => openCard(card, "tourist_attraction"));
  });
}

// ---------- AUTO OPEN FROM URL ----------
function autoOpenCityFromSearch() {
  const params = new URLSearchParams(window.location.search);
  const city = params.get("city");
  if (!city) return;

  const card = document.querySelector(`.place-card[data-city="${city.toLowerCase()}"]`);
  if (!card) return;

  card.scrollIntoView({ behavior: "smooth", block: "center" });
  openCard(card, "tourist_attraction");
}

// ---------- OPEN CARD ----------
async function openCard(card, type) {
  // close other cards
  closeAllPoiListsExcept(card);

  // zoom map to city
  const lat = parseFloat(card.dataset.lat);
  const lng = parseFloat(card.dataset.lng);
  map.panTo({ lat, lng });
  map.setZoom(12);

  // open this card's collapse
  const list = card.querySelector(".poi-results");
  if (list) {
    const collapse = new bootstrap.Collapse(list, { toggle: false });
    collapse.show();
    activeCollapse = collapse;
  }

  await fetchPOIs(card, type);
}

// ---------- CLOSE OTHER COLLAPSES ----------
function closeAllPoiListsExcept(activeCard) {
  document.querySelectorAll(".place-card").forEach(card => {
    if (card === activeCard) return;

    const list = card.querySelector(".poi-results");
    if (!list) return;

    // close with bootstrap collapse
    const collapse = bootstrap.Collapse.getInstance(list) || new bootstrap.Collapse(list, { toggle: false });
    collapse.hide();

    // clear results
    list.innerHTML = "";
  });
}

// ---------- FETCH POIS + MARKERS ----------
async function fetchPOIs(card, type) {
  const lat = parseFloat(card.dataset.lat);
  const lng = parseFloat(card.dataset.lng);
  const list = card.querySelector(".poi-results");

  if (!list) return;

  clearPoiMarkers();
  list.innerHTML = `<li class="text-muted">Loading...</li>`;

  try {
    const { places } = await google.maps.places.Place.searchNearby({
      locationRestriction: { center: { lat, lng }, radius: 3000 },
      includedTypes: [type],
      maxResultCount: 6,
      fields: ["displayName", "rating", "photos", "location"]
    });

    list.innerHTML = "";

    if (!places?.length) {
      list.innerHTML = `<li class="text-muted">No places found</li>`;
      return;
    }

    places.forEach((place, index) => {
      const photoUrl = place.photos?.length
        ? place.photos[0].getURI({ maxWidth: 240, maxHeight: 180 })
        : null;

      const li = document.createElement("li");
      li.className = "mb-2";

      li.innerHTML = `
        <div class="poi-card">
          ${photoUrl ? `<img src="${photoUrl}" class="poi-photo" alt="${place.displayName}">` : ""}
          <div class="w-100">
            <div class="poi-header">
              <span class="poi-name">${index + 1}. ${place.displayName}</span>
              ${place.rating ? `<span class="poi-rating">‚≠ê ${place.rating}</span>` : ""}
            </div>
            <div class="poi-type">${formatType(type)}</div>
          </div>
        </div>
      `;

      // clicking POI pans map
      li.addEventListener("click", () => {
        if (place.location) {
          map.panTo(place.location);
          map.setZoom(15);
        }
      });

      list.appendChild(li);

      // marker
      if (place.location) {
        const marker = new google.maps.Marker({
          map,
          position: place.location,
          title: place.displayName,
          label: `${index + 1}`
        });
        poiMarkers.push(marker);
      }
    });

  } catch (err) {
    console.error("Places error:", err);
    list.innerHTML = `<li class="text-danger">Error loading places</li>`;
  }
}

function clearPoiMarkers() {
  poiMarkers.forEach(m => m.setMap(null));
  poiMarkers = [];
}

// ---------- CITY CARD IMAGES ----------
async function hydrateCityImages() {
  const cards = document.querySelectorAll(".place-card");

  for (const card of cards) {
    const lat = parseFloat(card.dataset.lat);
    const lng = parseFloat(card.dataset.lng);

    // only targets <img class="place-photo"> (your placeholders)
    const img = card.querySelector("img.place-photo");
    if (!img || !lat || !lng) continue;

    // Only fill if no src already (keeps local photos like vienna.jpg)
    if (img.getAttribute("src")) continue;

    // nice default placeholder while loading
    img.src =
      "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='350'%3E%3Crect width='100%25' height='100%25' fill='%23eee'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-size='22'%3ELoading photo...%3C/text%3E%3C/svg%3E";

    try {
      const { places } = await google.maps.places.Place.searchNearby({
        locationRestriction: { center: { lat, lng }, radius: 5000 },
        includedTypes: ["tourist_attraction"],
        maxResultCount: 1,
        fields: ["photos"]
      });

      const photo = places?.[0]?.photos?.[0];
      if (!photo) continue;

      img.src = photo.getURI({ maxWidth: 800, maxHeight: 480 });
    } catch (err) {
      console.warn("City image failed:", card.dataset.city, err);
    }
  }
}

// ---------- BUTTONS ----------
window.showAttractions = (btn) => openCard(btn.closest(".place-card"), "tourist_attraction");
window.showRestaurants = (btn) => openCard(btn.closest(".place-card"), "restaurant");
window.showHotels = (btn) => openCard(btn.closest(".place-card"), "lodging");

// ---------- LABELS ----------
function formatType(type) {
  if (type === "restaurant") return "üçΩ Restaurant";
  if (type === "lodging") return "üè® Hotel";
  return "üìç Attraction";
}

// ---------- INIT MAP ----------
async function initMap() {
  await google.maps.importLibrary("maps");
  await google.maps.importLibrary("places");

  const mapEl = document.getElementById("map");
  if (!mapEl) {
    console.error("#map element not found");
    return;
  }

  map = new google.maps.Map(mapEl, {
    center: { lat: 50.8503, lng: 4.3517 },
    zoom: 5,
  });

  attachCardClickHandlers();
  await hydrateCityImages();
  autoOpenCityFromSearch();
}

// Run after everything is loaded (so bootstrap + map div exist)
window.addEventListener("load", () => {
  if (!window.google?.maps) {
    console.error("Google Maps did not load.");
    return;
  }
  initMap();
});



</script>


</head>
<body>
    <!-- Navbar section -->
<nav class="navbar navbar-expand-lg navbar-light bg-sky shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold text-warning" href="index.html">Euro City Stays</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse justify-content-end" id="mainNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link text-warning" href="index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link text-warning active" href="destinations.html">Destinations</a></li>
        <li class="nav-item">
          <a class="nav-link btn btn-warning text-dark px-3 ms-lg-2" href="book.html">BOOK NOW!</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- DESTINATIONS -->
<section class="container my-5">

  <!-- PARIS -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
     <div class="place-card" data-city="paris" data-lat="48.8566" data-lng="2.3522">
  <img class="place-photo" alt="City photo" />
  <div>
    <h6>Paris</h6>
    <small>Paris, France</small>

     <ul class="poi-results list-unstyled mt-2 collapse"></ul>
  </div>

   <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button><button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
</div>
</div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="vienna"
            data-lat="48.2082"
            data-lng="16.3738">
        <div>
        <img class="place-photo" alt="City photo" />
          <h6>Vienna</h6>
          <small>Vienna, Austria</small>
           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>

         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button><button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>

             
      </div>
    </div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="copenhagen"
            data-lat="55.6761"
            data-lng="12.5683">
 <img class="place-photo" alt="City photo" />
        <div>
          <h6>Copenhagen</h6>
          <small>Copenhagen, Denmark</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>

         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
        onclick="bookCity(this)">
        Book now
    </button>

  </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="place-card" 
            data-city="london"
            data-lat="51.5074"
            data-lng="-0.1278">
   <img class="place-photo" alt="City photo" />

        <div>
          <h6>London</h6>
          <small>London, UK</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>

         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="prague"
            data-lat="50.0755"
            data-lng="14.4378">
<img class="place-photo" alt="City photo" />

        <div>
          <h6>Prague</h6>
          <small>Prague, Czechia</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>

 <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="warsaw"
            data-lat="52.2297"
            data-lng="21.0122">
     <img class="place-photo" alt="City photo" />

        <div>
          <h6>Warsaw</h6>
          <small>Warsaw, Poland</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>
        
         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>
  </div>

  <!-- THIRD ROW -->
  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="place-card" 
            data-city="berlin"
            data-lat="52.5200"
            data-lng="13.4050">
  <img class="place-photo" alt="City photo" />

        <div>
          <h6>Berlin</h6>
          <small>Berlin, Germany</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>

         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="madrid"
            data-lat="40.168"
            data-lng="-3.7038">
   <img class="place-photo" alt="City photo" />

        <div>
          <h6>Madrid</h6>
          <small>Madrid, Spain</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>


         <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="place-card" 
            data-city="lisbon"
            data-lat="38.7223"
            data-lng="-9.1393">
    <img class="place-photo" alt="City photo" />

        <div>
          <h6>Lisbon</h6>
          <small>Lisbon, Portugal</small>

           <ul class="poi-results list-unstyled mt-2 collapse"></ul>
        </div>


 <div class="d-flex gap-2 mt-2">
    <button class="btn btn-sm btn-outline-primary"
      onclick="showAttractions(this)">
      Attractions
    </button>
    <button class="btn btn-sm btn-outline-success"
      onclick="showRestaurants(this)">
      Food
    </button>
    <button class="btn btn-sm btn-outline-danger"
      onclick="showHotels(this)">
      Hotels
    </button>
    <button class="btn btn-sm btn-warning text-dark"
  onclick="bookCity(this)">
  Book now
</button>

  </div>
      </div>
    </div>
  </div>
</section>

<!-- MAP PLACEHOLDER -->
<div id="map" class="map-container mt-4"></div>

<!-- Details Container -->

<div id="placeDetails" class="place-details d-none">
  <h5 id="placeName"></h5>
  <p id="placeAddress" class="text-muted"></p>
  <p id="placeRating"></p>
  <div id="placePhotos" class="d-flex gap-2 mt-2"></div>
</div>

<!-- FOOTER -->
<footer class="footer bg-danger text-light py-3 mt-5">
  <div class="container d-flex justify-content-between align-items-center flex-wrap">
    <small>Copyright ¬© 2026 Ashley Roberts. All rights reserved.</small>
    <strong>Euro City Stays</strong>
  </div>
</footer>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- FontAwesome script -->
<script src="https://kit.fontawesome.com/c818da147c.js" crossorigin="anonymous"></script>

<!-- Bootstrap script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</body>

</html>